<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Debug Viewer</title>
        <style>
            :root {
                --bg-color: #1e1e1e;
                --sidebar-color: #252526;
                --text-color: #cccccc;
                --accent-color: #0e639c;
                --accent-hover: #1177bb;
                --border-color: #3c3c3c;
                --hover-color: #2a2d2e;
                --active-color: #37373d;
                --cursor-highlight: rgba(14, 99, 156, 0.3);
                --font-family:
                    'Segoe UI', 'SF Pro Text', -apple-system, BlinkMacSystemFont, Roboto, Oxygen, Ubuntu, 'Droid Sans',
                    sans-serif;
                --code-font: 'Consolas', 'Menlo', 'Monaco', 'Courier New', monospace;
                --radius: 2px;
                --tab-active: #1e1e1e;
                --tab-inactive: #2d2d2d;
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: var(--font-family);
            }

            body {
                display: flex;
                height: 100vh;
                overflow: hidden;
                background-color: var(--bg-color);
                color: var(--text-color);
            }

            /* Sidebar */
            #sidebar {
                width: 250px;
                background: var(--sidebar-color);
                border-right: 1px solid var(--border-color);
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }

            #sidebar h2 {
                padding: 10px 20px;
                font-size: 11px;
                font-weight: 400;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                color: #6a6a6a;
                background-color: var(--sidebar-color);
                border-bottom: 1px solid var(--border-color);
            }

            #request-list {
                overflow-y: auto;
                flex: 1;
                padding: 0;
            }

            .request-item {
                padding: 8px 20px;
                cursor: pointer;
                font-size: 13px;
                transition: background 0.1s ease;
                border-left: 2px solid transparent;
            }

            .request-item:hover {
                background: var(--hover-color);
            }

            .request-item.active {
                background: var(--active-color);
                border-left: 2px solid var(--accent-color);
            }

            /* Main content */
            #main {
                flex: 1;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                background: var(--bg-color);
            }

            #header {
                display: flex;
                align-items: center;
                padding: 8px 16px;
                border-bottom: 1px solid var(--border-color);
                background: var(--bg-color);
            }

            #nav-buttons {
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .nav-btn {
                background: var(--active-color);
                border: 1px solid var(--border-color);
                border-radius: var(--radius);
                padding: 4px 10px;
                cursor: pointer;
                font-size: 12px;
                color: var(--text-color);
                transition: background 0.1s ease;
            }

            .nav-btn:hover:not(:disabled) {
                background: var(--hover-color);
            }

            .nav-btn:active:not(:disabled) {
                background: var(--accent-color);
            }

            .nav-btn:disabled {
                opacity: 0.5;
                cursor: default;
            }

            #current-id {
                margin: 0 16px;
                font-size: 13px;
                font-weight: normal;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                color: #9da5b4;
            }

            /* Tabs */
            #tabs {
                display: flex;
                background: var(--sidebar-color);
                border-bottom: 1px solid var(--border-color);
            }

            .tab {
                padding: 8px 16px;
                font-size: 12px;
                cursor: pointer;
                background: var(--tab-inactive);
                border-right: 1px solid var(--border-color);
                user-select: none;
            }

            .tab.active {
                background: var(--tab-active);
                border-bottom: 1px solid var(--accent-color);
                margin-bottom: -1px;
            }

            /* Content panels */
            .content-panel {
                flex: 1;
                position: relative;
                overflow: hidden;
                display: none;
            }

            .content-panel.active {
                display: flex;
                flex-direction: column;
            }

            /* Editor */
            #editor-container {
                flex: 1;
                position: relative;
                overflow: hidden;
            }

            .cursor-emoji {
                position: absolute;
                z-index: 100;
                font-size: 16px;
                pointer-events: none;
                animation: blink 1.2s step-end infinite;
                color: #ff3333;
                transform: scaleX(0.5); /* Make the cursor thinner */
                transform-origin: left;
            }

            @keyframes blink {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
            }

            /* Auto-trigger info panel */
            #auto-trigger-info {
                background: var(--active-color);
                border-top: 1px solid var(--border-color);
                max-height: 200px;
                overflow-y: auto;
                font-size: 12px;
            }

            #auto-trigger-container {
                padding: 8px 12px;
            }

            .trigger-section {
                margin-bottom: 10px;
            }

            .trigger-section h3 {
                font-size: 13px;
                margin-bottom: 6px;
                color: #e6e6e6;
            }

            .trigger-data {
                background: var(--bg-color);
                border-radius: 3px;
                padding: 8px;
                overflow: auto;
            }

            .trigger-property {
                margin-bottom: 4px;
                display: flex;
            }

            .property-name {
                color: #9cdcfe;
                margin-right: 8px;
                min-width: 180px;
            }

            .property-value {
                color: #ce9178;
            }

            .property-value.true {
                color: #4ec9b0;
            }

            .property-value.false {
                color: #f44747;
            }

            /* JSON panel */
            #json-container {
                flex: 1;
                position: relative;
                overflow: hidden;
            }

            .loading {
                display: flex;
                align-items: center;
                justify-content: center;
                height: 100%;
                color: #6a6a6a;
                font-size: 13px;
            }

            .loading::before {
                content: '';
                width: 16px;
                height: 16px;
                margin-right: 8px;
                border: 2px solid rgba(14, 99, 156, 0.2);
                border-top-color: var(--accent-color);
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            /* VSCode-style scrollbars */
            ::-webkit-scrollbar {
                width: 10px;
                height: 10px;
            }

            ::-webkit-scrollbar-track {
                background: var(--bg-color);
            }

            ::-webkit-scrollbar-thumb {
                background: var(--active-color);
                border-radius: 3px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: #555;
            }

            /* Status bar */
            #status-bar {
                height: 22px;
                background: var(--active-color);
                border-top: 1px solid var(--border-color);
                display: flex;
                align-items: center;
                padding: 0 10px;
                font-size: 12px;
                color: #9da5b4;
            }

            .status-item {
                margin-right: 10px;
                display: flex;
                align-items: center;
            }
        </style>
    </head>
    <body>
        <div id="sidebar">
            <h2>Debug Requests</h2>
            <div id="request-list">
                <div class="loading">Loading requests...</div>
            </div>
        </div>

        <div id="main">
            <div id="header">
                <div id="nav-buttons">
                    <button id="prev-btn" class="nav-btn" disabled>&larr; Prev</button>
                    <button id="next-btn" class="nav-btn" disabled>Next &rarr;</button>
                    <h3 id="current-id">Select a request</h3>
                </div>
            </div>

            <div id="tabs">
                <div class="tab active" data-tab="editor">Editor</div>
                <div class="tab" data-tab="json">Raw JSON</div>
            </div>

            <div id="editor-panel" class="content-panel active">
                <div id="editor-container">
                    <div class="loading">Select a request to view details</div>
                </div>
            </div>

            <div id="json-panel" class="content-panel">
                <div id="json-container">
                    <div class="loading">Select a request to view raw JSON</div>
                </div>
            </div>

            <div id="auto-trigger-info">
                <div id="auto-trigger-container">
                    <div class="loading">Select a request to view auto-trigger data</div>
                </div>
            </div>

            <div id="status-bar">
                <div class="status-item" id="status-language">Plain Text</div>
                <div class="status-item" id="status-position">Ln 1, Col 1</div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs/loader.min.js"></script>
        <script>
            // Config
            const endpoint = 'http://localhost:4000/'
            let editor = null
            let jsonEditor = null
            let requests = []
            let currentIndex = -1
            let cursorElement = null
            let currentRequestData = null

            // DOM elements
            const requestList = document.getElementById('request-list')
            const currentId = document.getElementById('current-id')
            const prevBtn = document.getElementById('prev-btn')
            const nextBtn = document.getElementById('next-btn')
            const editorContainer = document.getElementById('editor-container')
            const autoTriggerContainer = document.getElementById('auto-trigger-container')
            const jsonContainer = document.getElementById('json-container')
            const statusLanguage = document.getElementById('status-language')
            const statusPosition = document.getElementById('status-position')
            const tabs = document.querySelectorAll('.tab')
            const contentPanels = document.querySelectorAll('.content-panel')

            // Load Monaco
            require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs' } })
            require(['vs/editor/editor.main'], initApp)

            // Initialize app
            async function initApp() {
                // Set up Monaco editor theme
                monaco.editor.defineTheme('vscode-dark', {
                    base: 'vs-dark',
                    inherit: true,
                    rules: [],
                    colors: {
                        'editor.background': '#1e1e1e',
                        'editor.foreground': '#d4d4d4',
                        'editorCursor.foreground': '#d4d4d4',
                        'editor.lineHighlightBackground': '#2a2d2e',
                        'editorLineNumber.foreground': '#858585',
                        'editor.selectionBackground': '#264f78',
                        'editor.inactiveSelectionBackground': '#3a3d41',
                    },
                })

                setupNavigation()
                setupTabs()
                await loadRequests()
            }

            // Setup navigation
            function setupNavigation() {
                prevBtn.addEventListener('click', () => navigateToIndex(currentIndex - 1))
                nextBtn.addEventListener('click', () => navigateToIndex(currentIndex + 1))

                document.addEventListener('keydown', e => {
                    if (e.key === 'ArrowLeft' && currentIndex > 0) {
                        e.preventDefault()
                        navigateToIndex(currentIndex - 1)
                    } else if (e.key === 'ArrowRight' && currentIndex < requests.length - 1) {
                        e.preventDefault()
                        navigateToIndex(currentIndex + 1)
                    }
                })
            }

            // Setup tabs
            function setupTabs() {
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        // Deactivate all tabs
                        tabs.forEach(t => t.classList.remove('active'))
                        contentPanels.forEach(p => p.classList.remove('active'))

                        // Activate clicked tab
                        tab.classList.add('active')
                        const tabId = tab.getAttribute('data-tab')
                        document.getElementById(`${tabId}-panel`).classList.add('active')
                    })
                })
            }

            // Load requests
            async function loadRequests() {
                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            query: `{
              requestLogs {
                flareRequestId
                timestamp
                request
              }
            }`,
                        }),
                    })

                    const data = await response.json()

                    // Filter out telemetry events
                    requests = data.data.requestLogs.filter(req => {
                        try {
                            if (!req.request) return true
                            const requestData = JSON.parse(req.request)
                            return !requestData.telemetryEvent
                        } catch (e) {
                            return true
                        }
                    })

                    // Sort by timestamp (newest first)
                    requests.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))

                    renderRequestList()
                } catch (error) {
                    requestList.innerHTML = `<div class="loading">Error: ${error.message}</div>`
                }
            }

            // Render request list
            function renderRequestList() {
                requestList.innerHTML = ''

                if (requests.length === 0) {
                    requestList.innerHTML = '<div class="loading">No requests found</div>'
                    return
                }

                requests.forEach((request, index) => {
                    const item = document.createElement('div')
                    item.className = 'request-item'

                    // Format timestamp
                    const date = new Date(request.timestamp)
                    const timeStr = date.toLocaleTimeString([], {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                    })

                    item.textContent = `${request.flareRequestId.substring(0, 8)}... (${timeStr})`
                    item.title = request.flareRequestId

                    item.addEventListener('click', () => navigateToIndex(index))
                    requestList.appendChild(item)
                })
            }

            // Navigate to index
            function navigateToIndex(index) {
                if (index < 0 || index >= requests.length) return

                currentIndex = index

                // Update UI
                document.querySelectorAll('.request-item').forEach((item, i) => {
                    item.classList.toggle('active', i === index)
                })

                prevBtn.disabled = index <= 0
                nextBtn.disabled = index >= requests.length - 1

                loadRequestDetails(requests[index].flareRequestId)
            }

            // Position cursor emoji at the correct position in the editor
            function positionCursorEmoji(line, column) {
                if (!editor) return

                // Remove existing cursor emoji if any
                if (cursorElement) {
                    cursorElement.remove()
                }

                // Create cursor emoji element
                cursorElement = document.createElement('div')
                cursorElement.className = 'cursor-emoji'
                cursorElement.textContent = 'ðŸ–°'
                document.getElementById('editor-container').appendChild(cursorElement)

                // Get position coordinates from Monaco editor
                const position = editor.getScrolledVisiblePosition({ lineNumber: line, column: column })
                if (!position) return

                // Position the cursor emoji
                cursorElement.style.left = `${position.left}px`
                cursorElement.style.top = `${position.top}px`

                // Update status bar
                statusPosition.textContent = `Ln ${line}, Col ${column}`
            }

            // Render auto-trigger data
            function renderAutoTriggerData(requestData, debugLogs) {
                autoTriggerContainer.innerHTML = ''

                try {
                    // Find EditPredictionAutoTrigger data in debug logs
                    const editPredictionLogs = debugLogs.filter(
                        log =>
                            log.source === 'editPredictionAutoTrigger' &&
                            log.message === 'EditPredictionAutoTrigger evaluation result' &&
                            log.data
                    )

                    if (editPredictionLogs.length > 0) {
                        // Create section for EditPredictionAutoTrigger
                        const section = document.createElement('div')
                        section.className = 'trigger-section'

                        const title = document.createElement('h3')
                        title.textContent = 'Edit Prediction Auto-Trigger'
                        section.appendChild(title)

                        const dataContainer = document.createElement('div')
                        dataContainer.className = 'trigger-data'

                        // Parse the data from the log - it's a string that needs to be parsed as JSON
                        const triggerData = JSON.parse(editPredictionLogs[0].data)

                        // Required conditions
                        addPropertyGroup(dataContainer, 'Required Conditions', [
                            { name: 'hasRecentEdit', value: triggerData.hasRecentEdit },
                            { name: 'isNotInMiddleOfWord', value: triggerData.isNotInMiddleOfWord },
                            { name: 'isPreviousDecisionNotReject', value: triggerData.isPreviousDecisionNotReject },
                            { name: 'hasNonEmptySuffix', value: triggerData.hasNonEmptySuffix },
                            { name: 'requiredConditionsMet', value: triggerData.requiredConditionsMet },
                        ])

                        // Optional conditions
                        addPropertyGroup(dataContainer, 'Optional Conditions', [
                            { name: 'isAfterKeyword', value: triggerData.isAfterKeyword },
                            { name: 'isAfterOperatorOrDelimiter', value: triggerData.isAfterOperatorOrDelimiter },
                            { name: 'hasUserPaused', value: triggerData.hasUserPaused },
                            { name: 'isAtLineBeginning', value: triggerData.isAtLineBeginning },
                            { name: 'optionalConditionsMet', value: triggerData.optionalConditionsMet },
                        ])

                        // Code context
                        addPropertyGroup(dataContainer, 'Code Context', [
                            { name: 'cursor', value: triggerData.cursor, isBoolean: false },
                            { name: 'currentLine', value: triggerData.currentLine, isBoolean: false },
                        ])

                        // Result
                        addPropertyGroup(dataContainer, 'Result', [
                            { name: 'shouldTrigger', value: triggerData.shouldTrigger },
                        ])

                        section.appendChild(dataContainer)
                        autoTriggerContainer.appendChild(section)
                    } else {
                        // Check for other auto-trigger data in request data
                        const autoTriggerResult = findAutoTriggerResult(requestData)

                        if (autoTriggerResult) {
                            // Create section for regular AutoTrigger
                            const section = document.createElement('div')
                            section.className = 'trigger-section'

                            const title = document.createElement('h3')
                            title.textContent = 'Auto-Trigger'
                            section.appendChild(title)

                            const dataContainer = document.createElement('div')
                            dataContainer.className = 'trigger-data'

                            // Add properties
                            for (const key in autoTriggerResult) {
                                if (key !== 'shouldTrigger') {
                                    addProperty(dataContainer, key, autoTriggerResult[key])
                                }
                            }

                            // Result
                            addPropertyGroup(dataContainer, 'Result', [
                                { name: 'shouldTrigger', value: autoTriggerResult.shouldTrigger },
                            ])

                            section.appendChild(dataContainer)
                            autoTriggerContainer.appendChild(section)
                        } else {
                            // Add debug info to help troubleshoot
                            const debugInfo = document.createElement('div')
                            debugInfo.className = 'trigger-section'

                            const title = document.createElement('h3')
                            title.textContent = 'Debug Info'
                            debugInfo.appendChild(title)

                            const dataContainer = document.createElement('div')
                            dataContainer.className = 'trigger-data'

                            // Show how many debug logs we have
                            addProperty(dataContainer, 'Total debug logs', debugLogs.length)

                            // Show sources of debug logs
                            const sources = [...new Set(debugLogs.map(log => log.source))]
                            addProperty(dataContainer, 'Log sources', sources.join(', '))

                            // Show if we have any editPredictionAutoTrigger logs
                            const editPredictionLogsCount = debugLogs.filter(
                                log => log.source === 'editPredictionAutoTrigger'
                            ).length
                            addProperty(dataContainer, 'EditPrediction logs', editPredictionLogsCount)

                            debugInfo.appendChild(dataContainer)
                            autoTriggerContainer.appendChild(debugInfo)

                            autoTriggerContainer.innerHTML +=
                                '<div class="loading">No auto-trigger data found in this request</div>'
                        }
                    }
                } catch (e) {
                    autoTriggerContainer.innerHTML = `<div class="loading">Error parsing auto-trigger data: ${e.message}</div>`
                }
            }

            // Helper to find regular AutoTrigger result in the request
            function findAutoTriggerResult(requestData) {
                if (requestData.autoTriggerResult) {
                    return requestData.autoTriggerResult
                }
                return null
            }

            // Helper to add a property group to the container
            function addPropertyGroup(container, title, properties) {
                const groupTitle = document.createElement('div')
                groupTitle.style.fontWeight = 'bold'
                groupTitle.style.marginTop = '10px'
                groupTitle.style.marginBottom = '5px'
                groupTitle.style.color = '#569cd6'
                groupTitle.textContent = title
                container.appendChild(groupTitle)

                properties.forEach(prop => {
                    addProperty(container, prop.name, prop.value, prop.isBoolean !== false)
                })
            }

            // Helper to add a property to the container
            function addProperty(container, name, value, isBoolean = true) {
                const prop = document.createElement('div')
                prop.className = 'trigger-property'

                const propName = document.createElement('span')
                propName.className = 'property-name'
                propName.textContent = name + ':'
                prop.appendChild(propName)

                const propValue = document.createElement('span')
                propValue.className = 'property-value'

                if (isBoolean && (value === true || value === false)) {
                    propValue.classList.add(value ? 'true' : 'false')
                    propValue.textContent = value.toString()
                } else {
                    propValue.textContent = typeof value === 'string' ? value : JSON.stringify(value)
                }

                prop.appendChild(propValue)
                container.appendChild(prop)
            }

            // Load request details
            async function loadRequestDetails(requestId) {
                currentId.textContent = requestId
                editorContainer.innerHTML = '<div class="loading">Loading request details...</div>'
                autoTriggerContainer.innerHTML = '<div class="loading">Loading auto-trigger data...</div>'
                jsonContainer.innerHTML = '<div class="loading">Loading raw JSON...</div>'

                try {
                    // First get the request log
                    const requestLogResponse = await fetch(endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            query: `{
              requestLogByUUID(flareRequestId: "${requestId}") {
                flareRequestId
                request
                response
              }
            }`,
                        }),
                    })

                    // Then get the debug logs
                    const debugLogsResponse = await fetch(endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            query: `{
              debugLogsByUUID(flareRequestId: "${requestId}") {
                flareRequestId
                message
                data
                level
                source
              }
            }`,
                        }),
                    })

                    const requestLogData = await requestLogResponse.json()
                    const debugLogsData = await debugLogsResponse.json()

                    const details = requestLogData.data.requestLogByUUID
                    const debugLogs = debugLogsData.data.debugLogsByUUID || []

                    if (!details) {
                        editorContainer.innerHTML = '<div class="loading">No details found</div>'
                        autoTriggerContainer.innerHTML = '<div class="loading">No details found</div>'
                        jsonContainer.innerHTML = '<div class="loading">No details found</div>'
                        return
                    }

                    // Parse request data
                    try {
                        const requestData = JSON.parse(details.request)
                        currentRequestData = requestData

                        // Initialize JSON editor with both request log and debug logs
                        if (jsonEditor) jsonEditor.dispose()

                        const jsonEditorDiv = document.createElement('div')
                        jsonEditorDiv.style.width = '100%'
                        jsonEditorDiv.style.height = '100%'
                        jsonContainer.innerHTML = ''
                        jsonContainer.appendChild(jsonEditorDiv)

                        const combinedData = {
                            requestLog: details,
                            debugLogs: debugLogs,
                        }

                        jsonEditor = monaco.editor.create(jsonEditorDiv, {
                            value: JSON.stringify(combinedData, null, 2),
                            language: 'json',
                            theme: 'vscode-dark',
                            readOnly: true,
                            minimap: { enabled: false },
                            scrollBeyondLastLine: false,
                            automaticLayout: true,
                            fontSize: 13,
                            fontFamily: 'Consolas, Menlo, Monaco, "Courier New", monospace',
                        })

                        // Render auto-trigger data
                        renderAutoTriggerData(requestData, debugLogs)

                        if (requestData.editorState?.document?.text) {
                            // Clear editor container
                            editorContainer.innerHTML = ''

                            // Create editor
                            const editorDiv = document.createElement('div')
                            editorDiv.style.width = '100%'
                            editorDiv.style.height = '100%'
                            editorContainer.appendChild(editorDiv)

                            // Initialize editor
                            if (editor) editor.dispose()

                            const language =
                                requestData.editorState.document.programmingLanguage?.languageName || 'plaintext'
                            statusLanguage.textContent = language.charAt(0).toUpperCase() + language.slice(1)

                            editor = monaco.editor.create(editorDiv, {
                                value: requestData.editorState.document.text,
                                language: language,
                                theme: 'vscode-dark',
                                readOnly: true,
                                minimap: { enabled: false },
                                scrollBeyondLastLine: false,
                                automaticLayout: true,
                                fontSize: 13,
                                lineHeight: 20,
                                fontFamily: 'Consolas, Menlo, Monaco, "Courier New", monospace',
                                renderLineHighlight: 'line',
                                lineNumbers: 'on',
                                renderIndentGuides: true,
                                rulers: [],
                            })

                            // Set cursor position
                            const cursorPosition = requestData.editorState.cursorState?.position
                            if (cursorPosition) {
                                const line = cursorPosition.line + 1
                                const column = cursorPosition.character + 1

                                // Highlight the line
                                editor.deltaDecorations(
                                    [],
                                    [
                                        {
                                            range: new monaco.Range(line, 1, line, 1),
                                            options: {
                                                isWholeLine: true,
                                                className: 'cursor-line',
                                                linesDecorationsClassName: 'cursor-line-decoration',
                                            },
                                        },
                                    ]
                                )

                                // Position the cursor emoji
                                setTimeout(() => {
                                    positionCursorEmoji(line, column)
                                }, 100)

                                // Reveal position
                                editor.revealPositionInCenter({ lineNumber: line, column: column })

                                // Update cursor position when editor is scrolled
                                editor.onDidScrollChange(() => {
                                    positionCursorEmoji(line, column)
                                })
                            }
                        } else {
                            editorContainer.innerHTML =
                                '<div class="loading">No editor state found in this request</div>'
                        }
                    } catch (e) {
                        editorContainer.innerHTML = `<div class="loading">Error parsing data: ${e.message}</div>`
                        autoTriggerContainer.innerHTML = `<div class="loading">Error parsing data: ${e.message}</div>`
                        jsonContainer.innerHTML = `<div class="loading">Error parsing data: ${e.message}</div>`
                    }
                } catch (error) {
                    editorContainer.innerHTML = `<div class="loading">Error: ${error.message}</div>`
                    autoTriggerContainer.innerHTML = `<div class="loading">Error: ${error.message}</div>`
                    jsonContainer.innerHTML = `<div class="loading">Error: ${error.message}</div>`
                }
            }
        </script>
    </body>
</html>
